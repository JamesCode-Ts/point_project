<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Usuário</title>
    <link rel="stylesheet" type="text/css" href="/point_project/css/style.css">

    <!-- Inclua a biblioteca jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
   <!-- Usar o bootrap sem CDN
    <link rel="stylesheet" href="/webjars/bootstrap/4.6.0/dist/css/bootstrap.min.css">
     --> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
      

</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Navbar</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Link</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Dropdown
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link disabled" href="#">Disabled</a>
            </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
    </div>
</nav>

<div class="tabela-horario">
 
<form id="userForm1">
    <label for="exampleFormControlInput1" style="margin-top:5px" class="form-label">Horário de Trabalho:</label>
   <div class="row">
  <div class="col">
 
    <input type="text" class="form-control"  id="entrada" placeholder="Entrada" aria-label="First name">
  </div>
  <div class="col">
    <input type="text" class="form-control" id="saida" placeholder="Saída" aria-label="Last name">
  </div>


  
     <button type="button" id="cadastrarHorario" class="btn btn-primary">Cadastrar</button>
</form>

<table class="table">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Entrada</th>
      <th scope="col">Saída</th>
    </tr>
  </thead>
  <tbody id="tabelaRegistrosT1">
    <!-- Os registros serão adicionados aqui dinamicamente -->
  </tbody>
</table>
</div>
</div>

</div>

</div>

<div class="tabela-marcacao">
 
<form id="userForm2">
    <label for="exampleFormControlInput1" style="margin-top:5px" class="form-label">Marcações Feitas:</label>
   <div class="row">
  <div class="col">
 
    <input type="text" class="form-control"  id="entradaT2" placeholder="Entrada" aria-label="First name">
  </div>
  <div class="col">
    <input type="text" class="form-control"  id="saidaT2"placeholder="Saída" aria-label="Last name">
  </div>


  
  <button type="button" id="cadastrarMarcacao" class="btn btn-primary">Cadastrar</button>
 
  </form>

<table class="table">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Entrada</th>
      <th scope="col">Saída</th>
    </tr>
  </thead>
  <tbody id="tabelaRegistrosT2">
    <!-- Os registros serão adicionados aqui dinamicamente -->
  </tbody>
</table>
</div>

</div>



<table class="table">
  <thead>
    <tr>
      <th scope="col">Atraso</th>
      <th scope="col">Entrada</th>
      <th scope="col">Saída</th>
    </tr>
  </thead>
  <tbody id="tabelaAtraso">
    <!-- Os registros serão adicionados aqui dinamicamente -->
  </tbody>
</table>
</div>

</div>

<table class="table">
  <thead>
    <tr>
      <th scope="col">Hora Extra</th>
      <th scope="col">Entrada</th>
      <th scope="col">Saída</th>
    </tr>
  </thead>
  <tbody id="tabelaHoraExtra">
    <!-- Os registros serão adicionados aqui dinamicamente -->
  </tbody>
</table>
</div>


 <!-- Nova div para exibir resultados -->
    <div id="resultado"></div>
<script>
//Variável para armazenar os registros cadastrados na Tabela 1
let Tabela1 = [];

function cadastrarHorario() {
    if (Tabela1.length < 3) {
        let entrada = $('#entrada').val();
        let saida = $('#saida').val();

        // Verifica se o novo registro já existe na tabela
        const registroExistente = Tabela1.find(registro => registro.entrada === entrada && registro.saida === saida);
        
        if(registroExistente){
        	
        	alert("Horario já existe!");
        }

        if (!registroExistente) {
            // Cria um objeto com os dados do formulário
            const novoRegistroT1 = {
                entrada: entrada,
                saida: saida
            };

            // Adiciona o novo registro à tabela
            Tabela1.push(novoRegistroT1);

            limparCamposT1();
            // Atualiza a exibição dos registros
            exibirRegistrosTabela1();
        } else {
            alert('Os dados já existem na tabela!');
        }
    } else {
        alert('Limite de 3 registros atingido!');
    }
}
function exibirRegistrosTabela1() {
	  // Limpa a exibição atual da tabela
	  $('#tabelaRegistrosT1').empty();

	  // Exibe os registros na tabela
	   Tabela2.forEach((registro, index) => {
	    let numeroLinha = index + 1;
	    $('#tabelaRegistrosT1').append(`
	      <tr>
	        <th scope="row">${numeroLinha}</th>
	        <td>${registro.entrada}</td>
	        <td>${registro.saida}</td>
	      </tr>
	    `);
	  });
	}
	
	
function exibirRegistrosTabela2() {
	  // Limpa a exibição atual da tabela
	  $('#tabelaRegistrosT2').empty();

	  // Exibe os registros na tabela
	   Tabela1.forEach((registro, index) => {
	    let numeroLinha = index + 1;
	    $('#tabelaRegistrosT2').append(`
	      <tr>
	        <th scope="row">${numeroLinha}</th>
	        <td>${registro.entrada}</td>
	        <td>${registro.saida}</td>
	      </tr>
	    `);
	  });
	}
	
	
let Tabela2 = [];
function cadastrarMarcacao() {
  
        let entrada = $('#entradaT2').val();
        let saida = $('#saidaT2').val();

   
    
            // Cria um objeto com os dados do formulário
            const novoRegistroT2 = {
                entrada: entrada,
                saida: saida
            }

        // Adiciona o novo registro à lista
        Tabela2.push(novoRegistroT2);

        limparCamposT2();
        // Atualiza a exibição dos registros
        exibirRegistrosTabela2();
        
      //Chamada da função para calcular atrasos e horas extras
        calcularAtrasoHorasExtras();
  
}
//Limpa os campos do formulário
function limparCamposT2() {
    $('.form-control').val('');
}
//Limpa os campos do formulário
function limparCamposT1() {
    $('.form-control').val('');
}

function exibirRegistrosTabela2() {
	  // Limpa a exibição atual da tabela
	  $('#tabelaRegistrosT2').empty();

	  // Exibe os registros na tabela
	   Tabela2.forEach((registro, index) => {
	    let numeroLinha = index + 1;
	    $('#tabelaRegistrosT2').append(`
	      <tr>
	        <th scope="row">${numeroLinha}</th>
	        <td>${registro.entrada}</td>
	        <td>${registro.saida}</td>
	      </tr>
	    `);
	  });
	}




//Evento de clique no botão Cadastrar
$('#cadastrarHorario').click(function() {
  cadastrarHorario();
});

//Evento de clique no botão Cadastrar
$('#cadastrarMarcacao').click(function() {
	cadastrarMarcacao();
});

//Definir variáveis globais para armazenar os resultados
let resultadoAtrasos = [];
let resultadoHorasExtras = [];
function calcularAtrasoHorasExtras() {
    // Verificar se as tabelas estão definidas
    if (Tabela1 && Tabela2) {
        // Construir objeto com os dados das tabelas
              // Construir arrays com os dados das tabelas
        let tabelaHorario = Tabela1.map(objeto => `${objeto.entrada}-${objeto.saida}`);
        let tabelaMarcacoes = Tabela2.map(objeto => `${objeto.entrada}-${objeto.saida}`);

        // Fazer requisição AJAX para o back-end
        $.ajax({
            type: "POST",
            url: "calcularHoras",
            data: {
                tabelaHorario: JSON.stringify(tabelaHorario),
                tabelaMarcacoes: JSON.stringify(tabelaMarcacoes)
            },
            success: function(data) {
                // Atualizar as variáveis resultado com os dados recebidos
                resultadoAtrasos = data.atrasos;
                resultadoHorasExtras = data.horasExtras;

                // Exibir os resultados nas tabelas
                tabelaAtraso();
                // tabelaHoraExtra();
            },
            error: function() {
                alert('Erro ao calcular atrasos e horas extras.');
            }
        });
    } else {
        alert('Erro: As tabelas não estão definidas ou estão vazias.');
    }
}
//Função para exibir resultados na tabela de atraso
function tabelaAtraso() {
    // Limpar a exibição atual da tabela de atrasos
     $('#tabelaAtraso').empty();

    // Exibir os resultados na tabela de atrasos
    resultadoAtrasos.forEach((periodo, index) => {
        let numeroLinha = index + 1;

        // Adicionar a nova linha à tabela de atrasos
        $('#tabelaAtraso').append(`
            <tr>
                <th scope="row">${numeroLinha}</th>
                <td>${periodo.inicio}</td>
                <td>${periodo.fim}</td>
            </tr>
        `);
    });
}

//Função para exibir resultados na tabela de horas extras
function tabelaHoraExtra() {
 // Limpar a exibição atual da tabela de horas extras
 $('#tabelaHorasExtras').empty();

 // Exibir os resultados na tabela de horas extras
 resultadoHorasExtras.forEach((periodo, index) => {
     let numeroLinha = index + 1;
     $('#tabelaHorasExtras').append(`
         <tr>
             <th scope="row">${numeroLinha}</th>
             <td>${formatDate(periodo.inicio)}</td>
             <td>${formatDate(periodo.fim)}</td>
         </tr>
     `);
 });
}
    // Função para formatar uma data
    function formatDate(date) {
        var options = { hour: 'numeric', minute: 'numeric' };
        return new Date(date).toLocaleTimeString('pt-BR', options);
    }

  

</script>
</body>
</html>
